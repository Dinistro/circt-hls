#!/usr/bin/env bash

# The first argument to the script is the kernel or testbench which the Simulator
# was generated from.
# A testbench is defined as the kernel file prefixed with "tst_"

set -e
sourceDir=$(dirname $1)
basename=${1##*/}
basename=${basename%.*}

if [[ "$basename" == "tst_"* ]]; then
    basename=${basename#tst_}
fi

cp @CIRCT_HLS_BINARY_DIR@/tools/hlt/Simulator/hlt_verilator_CMakeLists.txt CMakeLists.txt
# Release building verilator simulators tends to be orders of magnitudes slower
# than debug builds
cmake -DHLT_TESTNAME=${basename} \
    -DCMAKE_BUILD_TYPE=Debug \
    -GNinja \
    . 
ninja
